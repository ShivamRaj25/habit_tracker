<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Me Supreme | Ultimate Habit Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Palette */
            --primary: #6366f1; /* Indigo */
            --primary-hover: #4f46e5;
            --secondary: #1e293b; /* Slate */
            --success: #10b981; /* Emerald */
            --danger: #ef4444;
            
            /* Surfaces */
            --bg: #f8fafc;
            --surface: #ffffff;
            --border: #e2e8f0;
            
            /* Text */
            --text-main: #0f172a;
            --text-muted: #64748b;
            
            /* Dimensions */
            --cell-size: 40px; /* Slightly larger for touch targets */
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        * { box-sizing: border-box; outline: none; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* --- Layout --- */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }

        /* --- Header --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: var(--surface);
            padding: 20px 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .brand h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--secondary);
            letter-spacing: -0.5px;
        }
        .brand span { color: var(--primary); }
        .brand small { color: var(--text-muted); font-size: 0.9rem; display: block; margin-top: 4px; }

        .controls { display: flex; gap: 12px; align-items: center; }

        select, button {
            padding: 10px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: inherit;
            background: var(--bg);
            cursor: pointer;
            transition: all 0.2s;
            color: var(--secondary);
            font-weight: 500;
        }

        select:hover, button:hover { border-color: var(--primary); background: #fff; }

        button.btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
            box-shadow: 0 2px 5px rgba(99, 102, 241, 0.3);
        }
        button.btn-primary:hover { background-color: var(--primary-hover); transform: translateY(-1px); }

        /* --- Dashboard --- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--surface);
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .card h3 {
            margin: 0 0 15px 0;
            font-size: 1rem;
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .chart-container {
            flex: 1;
            position: relative;
            min-height: 200px;
        }

        /* --- Habit Tracker Table --- */
        .tracker-wrapper {
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            overflow: hidden; 
            position: relative;
        }

        .table-scroll {
            overflow-x: auto;
            max-width: 100%;
        }

        /* Custom Scrollbar */
        .table-scroll::-webkit-scrollbar { height: 10px; }
        .table-scroll::-webkit-scrollbar-track { background: var(--bg); }
        .table-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 5px; }
        .table-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
        }

        th, td {
            border-right: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            text-align: center;
            vertical-align: middle;
            height: var(--cell-size);
            min-width: var(--cell-size);
            padding: 0;
        }

        /* Table Headers */
        thead th {
            background: var(--bg);
            color: var(--text-muted);
            font-weight: 600;
            font-size: 0.85rem;
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 10px 0;
        }

        /* The First Column (Habit Names) */
        th:first-child, td:first-child {
            position: sticky;
            left: 0;
            z-index: 20;
            background: var(--surface);
            border-right: 2px solid var(--border); /* Stronger separation */
            width: 260px;
            min-width: 260px;
            text-align: left;
            padding: 0 20px;
            font-weight: 500;
            color: var(--secondary);
        }

        th:first-child {
            z-index: 30; /* Top-Left Corner stays on top */
            background: var(--bg);
            text-align: left;
            padding-left: 20px;
        }

        /* Today Highlight */
        th.is-today, td.is-today {
            background-color: #eff6ff; /* Light blue tint */
            border-left: 1px solid var(--primary);
            border-right: 1px solid var(--primary);
        }
        th.is-today { color: var(--primary); font-weight: 800; }

        /* Habit Row Styles */
        tr:hover td:first-child { background: #f8fafc; }
        
        .habit-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .habit-info {
            display: flex;
            flex-direction: column;
        }

        .habit-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            width: fit-content;
            margin-top: 4px;
        }
        
        .delete-btn {
            opacity: 0;
            background: transparent;
            color: var(--text-muted);
            border: none;
            font-size: 1.2rem;
            padding: 0 5px;
            cursor: pointer;
            transition: opacity 0.2s, color 0.2s;
        }
        .delete-btn:hover { color: var(--danger); }
        tr:hover .delete-btn { opacity: 1; }

        /* Checkbox Interaction */
        .check-cell {
            cursor: pointer;
            transition: background 0.15s ease-out;
            user-select: none;
        }
        
        .check-cell:hover { background-color: #f1f5f9; }

        .check-cell.completed {
            background-color: var(--success);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        .check-cell.completed::after {
            content: '‚úì';
            color: white;
            font-weight: 800;
            font-size: 14px;
        }

        /* Input Area */
        .input-area {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: var(--bg);
            border-top: 1px solid var(--border);
            align-items: center;
        }
        .input-area input[type="text"] {
            flex: 2;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        .input-area input[type="time"] {
            flex: 0 0 auto;
            padding: 11px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }
        .input-area input:focus { border-color: var(--primary); }

        /* --- Analog Section --- */
        .analog-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            resize: vertical;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            line-height: 1.5;
            color: var(--secondary);
            background: #fafafa;
        }
        textarea:focus { border-color: var(--primary); background: #fff; }

        /* --- Print --- */
        @media print {
            body { background: white; -webkit-print-color-adjust: exact; }
            .app-container { padding: 0; max-width: 100%; }
            header, .input-area, .dashboard-grid { display: none !important; }
            .tracker-wrapper, .card { box-shadow: none; border: 1px solid #000; }
            th { background: #eee !important; color: black !important; }
            .check-cell.completed { background: #ddd !important; }
            .check-cell.completed::after { color: black; }
        }

        /* Mobile */
        @media (max-width: 768px) {
            .analog-grid { grid-template-columns: 1fr; }
            .controls { width: 100%; justify-content: space-between; }
            .controls select { flex: 1; }
            .input-area { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <header>
        <div class="brand">
            <h1>Aditi <span>hun</span></h1>
            <small>Mai kuch bhi kar sakti hun</small>
        </div>
        <div class="controls">
            <select id="monthSelect"></select>
            <select id="yearSelect"></select>
            <button class="btn-primary" onclick="window.print()">
                üñ®Ô∏è Save PDF
            </button>
        </div>
    </header>

    <div class="dashboard-grid">
        <div class="card">
            <h3>Monthly Completion</h3>
            <div class="chart-container">
                <canvas id="donutChart"></canvas>
            </div>
        </div>
        <div class="card">
            <h3>Daily Consistency Streak</h3>
            <div class="chart-container">
                <canvas id="lineChart"></canvas>
            </div>
        </div>
    </div>

    <div class="tracker-wrapper">
        <div class="table-scroll">
            <table id="habitTable">
                <thead>
                    <tr id="headerRow">
                        <th>Habit & Time</th>
                        </tr>
                </thead>
                <tbody id="habitBody">
                    </tbody>
            </table>
        </div>
        
        <div class="input-area">
            <input type="text" id="newHabitInput" placeholder="‚ú® Type a new habit (e.g., 'Read 15 pages')...">
            <input type="time" id="newHabitTime" title="When do you want to do this?">
            <button class="btn-primary" onclick="addHabit()">+ Add Habit</button>
        </div>
    </div>

    <div class="analog-grid">
        <div class="card">
            <h3>üèÜ Key Achievements</h3>
            <textarea id="achievementsBox" placeholder="List your big wins for this month..." oninput="saveNotes()"></textarea>
        </div>
        <div class="card">
            <h3>üß† Mood & Metrics Log</h3>
            <textarea id="metricsBox" placeholder="Track screen time, energy levels, or mood..." oninput="saveNotes()"></textarea>
        </div>
    </div>

</div>

<script>
    // --- Configuration ---
    const MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    const now = new Date();
    let currentYear = now.getFullYear();
    let currentMonth = now.getMonth(); 

    // Data Store
    let appData = {
        habits: [],
        records: {},
        notes: {}
    };

    // Chart Instances
    let donutChartInstance = null;
    let lineChartInstance = null;

    // --- Init ---
    window.onload = () => {
        loadData();
        initSelectors();
        renderTracker();
        renderCharts();
    };

    function initSelectors() {
        const mSelect = document.getElementById('monthSelect');
        const ySelect = document.getElementById('yearSelect');

        MONTHS.forEach((m, i) => {
            const opt = document.createElement('option');
            opt.value = i;
            opt.innerText = m;
            if(i === currentMonth) opt.selected = true;
            mSelect.appendChild(opt);
        });

        for(let y = currentYear - 3; y <= currentYear + 3; y++) {
            const opt = document.createElement('option');
            opt.value = y;
            opt.innerText = y;
            if(y === currentYear) opt.selected = true;
            ySelect.appendChild(opt);
        }

        const refresh = () => {
            currentMonth = parseInt(mSelect.value);
            currentYear = parseInt(ySelect.value);
            renderTracker();
            updateCharts();
            loadNotes();
        };

        mSelect.addEventListener('change', refresh);
        ySelect.addEventListener('change', refresh);
    }

    // --- Logic ---
    function getDaysInMonth(m, y) { return new Date(y, m + 1, 0).getDate(); }
    function getKey(id, d) { return `${id}_${currentYear}-${currentMonth}-${d}`; }
    
    // Updated Key Logic: We use localStorage to persist everything
    function saveData() {
        localStorage.setItem('meSupremeData_v3', JSON.stringify(appData));
        updateCharts();
    }

    function loadData() {
        // We use 'v3' to ensure fresh structure if you used previous versions
        const stored = localStorage.getItem('meSupremeData_v3');
        if (stored) {
            appData = JSON.parse(stored);
        } else {
            // Default Data Example
            appData.habits = [
                { id: 1, name: "üíß Drink 3L Water", time: "08:00" },
                { id: 2, name: "üìñ Read 30 Mins", time: "21:00" },
                { id: 3, name: "üèãÔ∏è Workout", time: "06:30" }
            ];
        }
        loadNotes();
    }

    function addHabit() {
        const inputName = document.getElementById('newHabitInput');
        const inputTime = document.getElementById('newHabitTime');
        
        const name = inputName.value.trim();
        const time = inputTime.value; // Returns "HH:MM" 24hr format or empty

        if(!name) return;
        
        // Add new habit with time property
        appData.habits.push({ 
            id: Date.now(), 
            name: name,
            time: time 
        });

        inputName.value = "";
        inputTime.value = "";
        saveData();
        renderTracker();
    }

    function deleteHabit(id) {
        if(confirm("Are you sure you want to delete this habit?")) {
            appData.habits = appData.habits.filter(h => h.id !== id);
            saveData();
            renderTracker();
        }
    }

    function toggleCheck(habitId, day, cellElement) {
        const key = getKey(habitId, day);
        if (appData.records[key]) {
            delete appData.records[key];
            cellElement.classList.remove('completed');
        } else {
            appData.records[key] = true;
            cellElement.classList.add('completed');
        }
        saveData();
    }

    function saveNotes() {
        const k = `${currentYear}-${currentMonth}`;
        appData.notes[`${k}-ach`] = document.getElementById('achievementsBox').value;
        appData.notes[`${k}-met`] = document.getElementById('metricsBox').value;
        localStorage.setItem('meSupremeData_v3', JSON.stringify(appData));
    }

    function loadNotes() {
        const k = `${currentYear}-${currentMonth}`;
        document.getElementById('achievementsBox').value = appData.notes[`${k}-ach`] || "";
        document.getElementById('metricsBox').value = appData.notes[`${k}-met`] || "";
    }

    // --- Render ---
    function renderTracker() {
        const daysCount = getDaysInMonth(currentMonth, currentYear);
        const headerRow = document.getElementById('headerRow');
        const tbody = document.getElementById('habitBody');
        
        const isCurrentRealMonth = (now.getMonth() === currentMonth && now.getFullYear() === currentYear);
        const todayDate = now.getDate();

        // Build Header
        headerRow.innerHTML = `<th>HABIT LIST (${appData.habits.length})</th>`;
        for(let d=1; d<=daysCount; d++) {
            const th = document.createElement('th');
            th.innerText = d;
            if(isCurrentRealMonth && d === todayDate) th.classList.add('is-today');
            headerRow.appendChild(th);
        }

        // Build Rows
        tbody.innerHTML = '';
        appData.habits.forEach(habit => {
            const tr = document.createElement('tr');
            
            // Name Column with Time Display
            const timeDisplay = habit.time ? `<span class="habit-time">‚è∞ ${habit.time}</span>` : '';
            
            const nameTd = document.createElement('td');
            nameTd.innerHTML = `
                <div class="habit-content">
                    <div class="habit-info">
                        <span>${habit.name}</span>
                        ${timeDisplay}
                    </div>
                    <button class="delete-btn" onclick="deleteHabit(${habit.id})">&times;</button>
                </div>`;
            tr.appendChild(nameTd);

            // Checks Columns
            for(let d=1; d<=daysCount; d++) {
                const td = document.createElement('td');
                td.className = 'check-cell';
                const key = getKey(habit.id, d);
                
                if(appData.records[key]) td.classList.add('completed');
                if(isCurrentRealMonth && d === todayDate) td.classList.add('is-today');

                td.onclick = function() { toggleCheck(habit.id, d, this); };
                tr.appendChild(td);
            }
            tbody.appendChild(tr);
        });
    }

    // --- Charts ---
    function renderCharts() {
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' } }
        };

        const ctxDonut = document.getElementById('donutChart').getContext('2d');
        donutChartInstance = new Chart(ctxDonut, {
            type: 'doughnut',
            data: {
                labels: ['Done', 'Left'],
                datasets: [{
                    data: [0, 100],
                    backgroundColor: ['#10b981', '#f1f5f9'],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: { ...commonOptions, cutout: '70%' }
        });

        const ctxLine = document.getElementById('lineChart').getContext('2d');
        lineChartInstance = new Chart(ctxLine, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Habits Completed',
                    data: [],
                    borderColor: '#6366f1',
                    backgroundColor: 'rgba(99, 102, 241, 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 2
                }]
            },
            options: {
                ...commonOptions,
                scales: {
                    x: { grid: { display: false } },
                    y: { beginAtZero: true, grid: { color: '#f1f5f9' } }
                }
            }
        });

        updateCharts();
    }

    function updateCharts() {
        if(!donutChartInstance || !lineChartInstance) return;

        const daysCount = getDaysInMonth(currentMonth, currentYear);
        const totalPossible = daysCount * appData.habits.length;
        let totalDone = 0;
        const dailyCounts = new Array(daysCount).fill(0);
        const labels = [];

        for(let d=1; d<=daysCount; d++) {
            labels.push(d);
            appData.habits.forEach(h => {
                if(appData.records[getKey(h.id, d)]) {
                    totalDone++;
                    dailyCounts[d-1]++;
                }
            });
        }

        // Update Donut
        const safeTotal = totalPossible === 0 ? 1 : totalPossible;
        const remaining = Math.max(0, safeTotal - totalDone);
        donutChartInstance.data.datasets[0].data = [totalDone, remaining];
        donutChartInstance.update();

        // Update Line
        lineChartInstance.data.labels = labels;
        lineChartInstance.data.datasets[0].data = dailyCounts;
        lineChartInstance.update();
    }
</script>

</body>
</html>